packages:
  yum:
    nginx: []

files:
  "/etc/nginx/conf.d/proxy.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
    content: |
        server {
            listen 80;
            server_name typebotbuilder.whiteblinkcmds.com;
            return 301 https://$host$request_uri;
        }

        server {
            listen 80;
            server_name typebotviewer.whiteblinkcmds.com;
            return 301 https://$host$request_uri;
        }

        server {
            listen 443 ssl;
            server_name typebotbuilder.whiteblinkcmds.com;

            # SSL certificate paths
            ssl_certificate /etc/letsencrypt/live/typebotbuilder.whiteblinkcmds.com/fullchain.pem;
            ssl_certificate_key /etc/letsencrypt/live/typebotbuilder.whiteblinkcmds.com/privkey.pem;

            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";

            # Proxy requests to typebot-builder (port 8080)
            location / {
                proxy_pass http://typebotbuilder.whiteblinkcmds.com:8080;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
            }
        }

        server {
            listen 443 ssl;
            server_name typebotviewer.whiteblinkcmds.com;

            # SSL certificate paths
            ssl_certificate /etc/letsencrypt/live/typebotviewer.whiteblinkcmds.com/fullchain.pem;
            ssl_certificate_key /etc/letsencrypt/live/typebotviewer.whiteblinkcmds.com/privkey.pem;

            ssl_protocols TLSv1.2 TLSv1.3;
            ssl_prefer_server_ciphers on;
            ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";

            # Proxy requests to typebot-viewer (port 8081)
            location / {
                proxy_pass http://typebotviewer.whiteblinkcmds.com:8081;
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Proto $scheme;
            }
        }
